{% extends "layout/base.html" %}

{% block title %}Cadastro - SaaS Sistema{% endblock %}

{% block extra_css %}
<style>
.divider {
    text-align: center;
    margin: 1.5rem 0;
    position: relative;
}

.divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #dee2e6;
}

.divider span {
    background: white;
    padding: 0 1rem;
    color: #6c757d;
    font-size: 0.9rem;
}

.google-btn {
    border: 2px solid #db4437;
    color: #db4437;
    transition: all 0.3s ease;
}

.google-btn:hover {
    background-color: #db4437;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(219, 68, 55, 0.3);
}

.google-btn i {
    font-size: 1.1rem;
}

/* Estilos para requisitos de senha */
.requirement-item {
    font-size: 0.85rem;
    margin: 0.25rem 0;
    transition: all 0.3s ease;
}

.requirement-item.valid {
    color: #198754;
}

.requirement-item.valid i {
    color: #198754 !important;
}

.requirement-item.invalid {
    color: #dc3545;
}

.requirement-item.invalid i {
    color: #dc3545 !important;
}

#password-requirements {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 0.75rem;
    margin-top: 0.5rem;
}

#password-requirements .text-muted {
    font-weight: 600;
    color: #495057 !important;
}
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card fade-in">
        <div class="auth-header">
            <h2>Criar Conta</h2>
            <p>Cadastre-se para começar a usar o sistema</p>
        </div>

        <form method="POST" class="needs-validation" novalidate>
            <div class="mb-3">
                <label for="username" class="form-label">
                    Nome de Usuário
                </label>
                <input type="text" class="form-control" id="username" name="username" required>
                <div class="invalid-feedback">
                    Por favor, insira seu nome de usuário.
                </div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">
                    Email
                </label>
                <input type="email" class="form-control" id="email" name="email" required>
                <div class="invalid-feedback">
                    Por favor, insira um email válido.
                </div>
            </div>

            <div class="mb-3">
                <label for="empresa" class="form-label">
                    Nome da Empresa
                </label>
                <input type="text" class="form-control" id="empresa" name="empresa" required>
                <div class="invalid-feedback">
                    Por favor, insira o nome da sua empresa.
                </div>
            </div>

            <div class="mb-4">
                <label for="password" class="form-label">
                    Senha
                </label>
                <input type="password" class="form-control" id="password" name="password" required minlength="8">
                <div class="invalid-feedback">
                    A senha deve atender a todos os requisitos abaixo.
                </div>
                
                <!-- Requisitos da Senha -->
                <div class="mt-2" id="password-requirements">
                    <small class="text-muted">Requisitos da senha:</small>
                    <ul class="list-unstyled mt-1 mb-0" id="requirement-list">
                        <li id="req-length" class="requirement-item">
                            
                            <span>Pelo menos 8 caracteres</span>
                        </li>
                        <li id="req-uppercase" class="requirement-item">
                            
                            <span>Uma letra maiúscula (A-Z)</span>
                        </li>
                        <li id="req-lowercase" class="requirement-item">
                            
                            <span>Uma letra minúscula (a-z)</span>
                        </li>
                        <li id="req-number" class="requirement-item">
                            
                            <span>Um número (0-9)</span>
                        </li>
                        <li id="req-special" class="requirement-item">
                            
                            <span>Um caractere especial (!@#$%^&*)</span>
                        </li>
                    </ul>
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-100 mb-3">
                Criar Conta
            </button>
        </form>

        {% if google_configured %}
        <!-- Divisor -->
        <div class="divider">
            <span>ou</span>
        </div>

        <!-- Botão Google -->
        <a href="{{ url_for('google_login') }}" class="btn btn-outline-danger w-100 mb-3 google-btn">
            Cadastrar com Google
        </a>
        {% endif %}

        <div class="text-center">
            <p class="mb-0">Já tem uma conta? 
                <a href="{{ url_for('login') }}" class="text-decoration-none">
                    Faça login aqui
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const requirementItems = {
        length: document.getElementById('req-length'),
        uppercase: document.getElementById('req-uppercase'),
        lowercase: document.getElementById('req-lowercase'),
        number: document.getElementById('req-number'),
        special: document.getElementById('req-special')
    };
    
    // Função para validar requisitos da senha
    function validatePassword(password) {
        const requirements = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
        };
        
        return requirements;
    }
    
    // Função para atualizar visual dos requisitos
    function updateRequirementVisual(requirements) {
        Object.keys(requirements).forEach(key => {
            const item = requirementItems[key];
            const icon = item.querySelector('i');
            
            if (requirements[key]) {
                // Requisito atendido
                item.classList.remove('invalid');
                item.classList.add('valid');
                icon.className = 'fas fa-check text-success me-1';
            } else {
                // Requisito não atendido
                item.classList.remove('valid');
                item.classList.add('invalid');
                icon.className = 'fas fa-times text-danger me-1';
            }
        });
    }
    
    // Função para verificar se todos os requisitos foram atendidos
    function allRequirementsMet(requirements) {
        return Object.values(requirements).every(req => req === true);
    }
    
    // Event listener para validação em tempo real
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        const requirements = validatePassword(password);
        updateRequirementVisual(requirements);
        
        // Atualizar validação do campo
        const allMet = allRequirementsMet(requirements);
        if (password.length > 0 && !allMet) {
            this.setCustomValidity('A senha deve atender a todos os requisitos');
        } else {
            this.setCustomValidity('');
        }
    });
    
    // Validação no envio do formulário
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const requirements = validatePassword(password);
        const allMet = allRequirementsMet(requirements);
        
        if (!allMet) {
            e.preventDefault();
            passwordInput.focus();
            
            // Destacar requisitos não atendidos
            Object.keys(requirements).forEach(key => {
                if (!requirements[key]) {
                    requirementItems[key].style.backgroundColor = '#fff5f5';
                    requirementItems[key].style.borderRadius = '0.25rem';
                    requirementItems[key].style.padding = '0.25rem';
                }
            });
            
            alert('Por favor, atenda a todos os requisitos da senha antes de continuar.');
        }
    });
    
    // Limpar destaque quando o usuário começar a digitar novamente
    passwordInput.addEventListener('focus', function() {
        Object.values(requirementItems).forEach(item => {
            item.style.backgroundColor = '';
            item.style.borderRadius = '';
            item.style.padding = '';
        });
    });
});
</script>
{% endblock %}

